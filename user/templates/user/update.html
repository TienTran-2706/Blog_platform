{% extends "base.html" %}

{% block content %}
    <h2>Update Profile</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Save Changes</button>
    </form>
    {% if messages %}
        {% for message in messages %}
            <p>{{ message }}</p>
        {% endfor %}
    {% endif %}
{% endblock %}
class LoginView(View):

    def get(self, request):
        """
        Renders the login form.
        """
        try:
            form = LoginForm()
            logger.info('Login form rendered')
            return render(request, 'user/login.html', {'form': form})
        except Exception as e:
            # Handle unexpected error
            logger.error(f"An error occurred: {e}")
            return custom_error_handler(request, e)

    def post(self, request):
        """
        Handles POST requests and logs in the user if the form data is valid.
        """
        try:
            form = LoginForm(request.POST)
            if form.is_valid():
                username = form.cleaned_data['username']
                password = form.cleaned_data['password']
                user = authenticate(request, username=username, password=password)
                if user is not None:
                    login(request, user)
                    return redirect('profile')
                else:
                    form.add_error(None, 'Invalid username or password')
            return render(request, 'user/login.html', {'form': form})
        except Exception as e:
            logger.error(f"An error occurred: {e}")
            return custom_error_handler(request, e)

class LoginView(View):

    def get(self, request):
        """
        Renders the login form.
        """
        try:
            form = LoginForm()
            logger.info('Login form rendered')
            return render(request, 'user/login.html', {'form': form})
        except Exception as e:
            # Handle unexpected error
            logger.error(f"An error occurred: {e}")
            return custom_error_handler(request, e)

    def post(self, request):
        """
        Handles POST requests and logs in the user if the form data is valid.
        """
        try:
            form = LoginForm(request.POST)
            if form.is_valid():
                username = form.cleaned_data['username']
                password = form.cleaned_data['password']
                user = authenticate(request, username=username, password=password)
                if user is not None:
                    login(request, user)
                    return redirect('profile')
                else:
                    form.add_error(None, 'Invalid username or password')
            return render(request, 'user/login.html', {'form': form})
        except Exception as e:
            logger.error(f"An error occurred: {e}")
            return custom_error_handler(request, e)

